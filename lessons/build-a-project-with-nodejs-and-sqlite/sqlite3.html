<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png"/><link rel="icon" type="image/x-icon" href="/images/favicon.ico"/><title>sqlite3 – Complete Intro to SQLite</title><meta name="description" content="Learn how to build on SQLite with this quick and complete course with Brian Holt. SQLite is a powerful database that is easy to get started with and is a great tool for building both small and large applications."/><meta name="keywords" content="SQL,SQLite,Databases,Web Development,Node.js,JavaScript,Brian Holt,Frontend Masters"/><meta name="og:description" content="Learn how to build on SQLite with this quick and complete course with Brian Holt. SQLite is a powerful database that is easy to get started with and is a great tool for building both small and large applications."/><meta name="og:title" content="sqlite3 – Complete Intro to SQLite"/><meta name="og:image" content="/images/social-share-cover.jpg"/><meta name="twitter:card" content="summary_large_image"/><meta name="next-head-count" content="14"/><link data-next-font="size-adjust" rel="preconnect" href="/" crossorigin="anonymous"/><link rel="preload" href="/_next/static/css/27123e75b7d47aaa.css" as="style"/><link rel="stylesheet" href="/_next/static/css/27123e75b7d47aaa.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/_next/static/chunks/webpack-4e7214a60fad8e88.js" defer=""></script><script src="/_next/static/chunks/framework-ecc4130bc7a58a64.js" defer=""></script><script src="/_next/static/chunks/main-be89c515900796e7.js" defer=""></script><script src="/_next/static/chunks/pages/_app-a9fbd9f7480465a3.js" defer=""></script><script src="/_next/static/chunks/pages/lessons/%5Bsection%5D/%5Bslug%5D-f133ec3e69124099.js" defer=""></script><script src="/_next/static/UVFsG-h6A31FVwYuYsLRa/_buildManifest.js" defer=""></script><script src="/_next/static/UVFsG-h6A31FVwYuYsLRa/_ssgManifest.js" defer=""></script></head><body><div id="__next"><div class="remix-app"><header class="navbar"><h1 class="navbar-brand"><a href="/">Complete Intro to SQLite</a></h1><div class="navbar-info"><a href="https://frontendmasters.com/workshops/sqlite/" class="cta-btn">Watch on Frontend Masters</a></div></header><div class="content-container"><div class="main"><div class="lesson-container"><div class="lesson"><div class="lesson-content"><p>There are so many libraries for connecting to SQLite. It&#39;s a very ubiquitious piece of software and so lots of people have opinions on how to build with it.</p>
<p>I am going to show you the standard one, the first one, the one that everyone knows. I will say that when I build stuff with SQLite, it is <em>not</em> the one I normally choose. However I think it&#39;s good for you to get exposure to the OG and then you can branch out and choose other libraries once you know what you&#39;re getting away from.</p>
<p><a href="https://github.com/TryGhost/node-sqlite3/wiki/API">Click here</a> to go to the sqlite3 docs.</p>
<blockquote>
<p>Why is it sqlite3? It&#39;s because it&#39;s for version 3 of SQLite, the third major version.</p>
</blockquote>
<h2>Connecting to the database</h2>
<p>Connecting to a SQLite database from Node.js is a snap. Import the the sqlite3 library and create a <code>new</code> database.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">import</span> sqlite3 <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;sqlite3&quot;</span>;

<span class="hljs-keyword">const</span> db = <span class="hljs-keyword">new</span> sqlite3.<span class="hljs-title class_">Database</span>(<span class="hljs-string">&quot;./my-database.db&quot;</span>);
</code></pre><p>Again, keep in mind that SQLite databases are files. You need to give it a file path to be able to open the database and to start writing to it.</p>
<h2>Querying the database</h2>
<p>Once you have your <code>db</code> Database instance, you can then start running queries. There&#39;s a few functions to be aware of. We&#39;ll talk about the parameters to the functions after this.</p>
<ul>
<li><code>db.run(sql, params, callback)</code> – This will run a query and not care about the results. You generally use this to run <code>UPDATE</code> and <code>DELETE</code> commands as you&#39;re just updating and not necessarily caring about what the database has to say back to you.</li>
<li><code>db.get(sql, params, callback)</code> – Runs a query and only gives you back the first one. Some times all you need is one result (like when you&#39;re querying a unique ID). This simplifies your code a bit because you don&#39;t need an array of one result.</li>
<li><code>db.all(sql, params, callback)</code> – Like get, but it gives you all results back that match the query instead of just one. It always returns an array. If you got no results, you get an empty array</li>
<li><code>db.each(sql, params, callback, complete)</code> – Like all, but instead of one big array of results, your callback will get called once for each row in the set. Then the complete function will be called to let you know it&#39;s done. This is nice if you have some action you want to take on each row as it&#39;s basically a <code>.map()</code> of the result set instead of an array.</li>
</ul>
<h2>Node.js style callbacks (a.k.a. &quot;Nodebacks&quot;)</h2>
<p>Some of you whippersnappers may be too young to remember writing JavaScript before promises, async-await, generators, etc. Before the magical time of ES2015 / ES6, we only had one way to deal with asynchronous code, callbacks. These are just functions that are invoked when something async completes. JS has since long moved past this (nearly a decade as of writing) and it&#39;s to the point that it feels weird to write callbacks as we&#39;ve been writing promises so long.</p>
<p>sqlite3 never updated to use promises so you still have to use Node.js-style callbacks (or Nodebacks, as they were sometimes called.) They are Node.js callbacks as they always have the signature of <code>function myCallback(error, data)</code>. If that <code>error</code> is populated with anything, it means that something went wrong. Otherwise it succeeded. That&#39;s it. That&#39;s what makes a &quot;Nodeback&quot;.</p>
<p>So with <code>.all()</code>, your code will look like this</p>
<pre><code class="hljs language-javascript">db.<span class="hljs-title function_">rows</span>(
  <span class="hljs-string">`SELECT * FROM Track WHERE name LIKE &#x27;%live%&#x27;`</span>,
  [], <span class="hljs-comment">// we&#x27;ll talk about this array in a sec</span>
  <span class="hljs-keyword">function</span> (<span class="hljs-params">err, rows</span>) {
    <span class="hljs-keyword">if</span> (err) {
      <span class="hljs-comment">// do error stuff here</span>
      <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-comment">// do stuff here with rows</span>
  }
);
</code></pre><h2>Parameters and SQL Injection</h2>
<p>Let&#39;s take this example:</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> id = <span class="hljs-title function_">getIdFromUser</span>();
db.<span class="hljs-title function_">get</span>(<span class="hljs-string">`SELECT * FROM Track WHERE TrackId=<span class="hljs-subst">${id}</span>`</span>, [], <span class="hljs-keyword">function</span> (<span class="hljs-params">err, row</span>) {
  <span class="hljs-comment">// do stuff</span>
});
</code></pre><p>What&#39;s wrong with this? There&#39;s a <strong>major</strong> problem with this. If that id is coming from a user, it means they can put <em>anything</em> there, right? So they could in theory put valid SQL in there. What if they put <code>15; DROP TABLE Customer</code>? Then your SQL statement would be <code>SELECT * FROM Track WHERE id=15; DROP TABLE Customer</code>. Uh oh, good bye to all your customer data. They could also do even more nefarious things like steal your data. This is called SQL injection. This is why you <strong>never, ever, ever, ever</strong> put user input directly into a SQL statement. You <em>always</em> let the library do it for you. No exceptions.</p>
<p>So how do we fix this? sqlite3 gives us that array to handle just that.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> id = <span class="hljs-title function_">getIdFromUser</span>();
db.<span class="hljs-title function_">get</span>(<span class="hljs-string">`SELECT * FROM Track WHERE TrackId=?`</span>, [id], <span class="hljs-keyword">function</span> (<span class="hljs-params">err, row</span>) {
  <span class="hljs-comment">// do stuff</span>
});
</code></pre><p>Done! By replacing it with the question mark and providing the user input in the array, sqlite3 will guarantee you that it&#39;s safe to use that no matter where it came from. You can also use an object notation.</p>
<pre><code class="hljs language-javascript"><span class="hljs-keyword">const</span> id = <span class="hljs-title function_">getIdFromUser</span>();
db.<span class="hljs-title function_">get</span>(
  <span class="hljs-string">`SELECT * FROM Track WHERE TrackId=$id`</span>,
  { <span class="hljs-attr">$id</span>: id },
  <span class="hljs-keyword">function</span> (<span class="hljs-params">err, row</span>) {
    <span class="hljs-comment">// do stuff</span>
  }
);
</code></pre><p>Both are fine. Question marks rely on order, objection notation relies on names matching.</p>
<p>This should be enough of an intro for you to write your sample app.</p>
</div><div class="lesson-links"><a href="/lessons/build-a-project-with-nodejs-and-sqlite/the-example-app" class="prev">← Previous</a><a href="/lessons/build-a-project-with-nodejs-and-sqlite/project" class="next">Next →</a></div></div><div class="details-bg"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="154" height="154" viewBox="0 0 154 154"><defs><clipPath id="clip-path"><rect id="Rectangle_2238" data-name="Rectangle 2238" width="154" height="154" transform="translate(9467 350)" fill="#fff" stroke="#707070" stroke-width="1"></rect></clipPath><clipPath id="clip-corner-image-active"><rect width="154" height="154"></rect></clipPath></defs><g id="corner-image-active" clip-path="url(#clip-corner-image-active)"><g id="Corner-image-active-2" data-name="Corner-image-active" transform="translate(-9467 -350)" clip-path="url(#clip-path)"><path id="Subtraction_34" data-name="Subtraction 34" d="M-3857.365,1740.766h0l-7.07-7.07,12.89-12.89v14.142l-5.818,5.818Zm-14.142-14.142h0l-7.071-7.07,27.033-27.033v14.143l-19.96,19.96Zm-14.143-14.143h0l-7.07-7.069,41.175-41.175v14.142Zm-14.142-14.142h0l-7.07-7.069,55.317-55.317v14.142Zm-14.142-14.142h0l-7.07-7.069,69.459-69.459v14.142Zm-14.142-14.142h0l-7.07-7.069,76.739-76.739h6.862v7.28Zm-14.143-14.143h0l-7.07-7.069,62.6-62.6h14.142Zm-14.142-14.142h0l-7.07-7.069,48.454-48.454h14.142Zm-14.142-14.142h0l-7.07-7.069,34.312-34.312h14.142Zm-14.142-14.142h0l-7.07-7.069,20.17-20.17h14.142Zm-14.142-14.142h0l-7.071-7.071,6.027-6.027h14.144l-13.1,13.1Zm367.24-56.114v-.909l.455.455-.453.453Z" transform="translate(13472.546 -1236.766)" fill="var(--corner-fill)"></path></g></g></svg></div></div></div></div><script async="" defer="" src="https://a.holt.courses/latest.js"></script><noscript><img src="https://a.holt.courses/noscript.gif" alt="" referrerPolicy="no-referrer-when-downgrade"/></noscript><footer class="footer"><ul class="socials"><li class="social"><a href="https://twitter.com/holtbt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="40" height="32" viewBox="0 0 40 32"><defs><clipPath id="clip-twitter-social"><rect width="40" height="32"></rect></clipPath></defs><g id="twitter-social" clip-path="url(#clip-twitter-social)"><g id="Group_269" data-name="Group 269" transform="translate(-230.23 -1140.849)"><path id="Path_419" data-name="Path 419" d="M266.12,1148.861v1.035a23.092,23.092,0,0,1-1.507,8.1,24.08,24.08,0,0,1-4.475,7.381,22.175,22.175,0,0,1-7.306,5.4,24.129,24.129,0,0,1-10,2.07,23.7,23.7,0,0,1-6.667-.945,22.83,22.83,0,0,1-5.936-2.655q.959.091,1.963.09a16.518,16.518,0,0,0,5.434-.9,17.111,17.111,0,0,0,4.749-2.52,8.275,8.275,0,0,1-4.749-1.643,7.8,7.8,0,0,1-2.877-3.983,8.268,8.268,0,0,0,1.507.135,8.58,8.58,0,0,0,2.146-.27,8.16,8.16,0,0,1-5.685-4.344,8.326,8.326,0,0,1-.89-3.578v-.135a7.775,7.775,0,0,0,3.744,1.035,8.183,8.183,0,0,1-2.671-2.9,7.817,7.817,0,0,1-.982-3.848,7.948,7.948,0,0,1,1.1-4.05,23.53,23.53,0,0,0,16.895,8.46,9.221,9.221,0,0,1-.183-1.845,7.787,7.787,0,0,1,1.1-4.05,8.216,8.216,0,0,1,2.991-2.948,7.991,7.991,0,0,1,4.087-1.1,8.184,8.184,0,0,1,5.982,2.566,16.087,16.087,0,0,0,5.205-1.98,7.784,7.784,0,0,1-1.393,2.588,8.4,8.4,0,0,1-2.215,1.913,16.856,16.856,0,0,0,4.749-1.305A17.032,17.032,0,0,1,266.12,1148.861Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><a href="https://github.com/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-github-social"><rect width="32" height="32"></rect></clipPath></defs><g id="github-social" clip-path="url(#clip-github-social)"><g id="Group_272" data-name="Group 272" transform="translate(13522.5 -6994)"><path id="Subtraction_33" data-name="Subtraction 33" d="M-24967.5,8041a15.9,15.9,0,0,1-11.312-4.688A15.893,15.893,0,0,1-24983.5,8025a15.893,15.893,0,0,1,4.689-11.315A15.894,15.894,0,0,1-24967.5,8009a15.894,15.894,0,0,1,11.313,4.686A15.893,15.893,0,0,1-24951.5,8025a15.893,15.893,0,0,1-4.689,11.313A15.9,15.9,0,0,1-24967.5,8041Zm-3.781-4.571h0v3.918h7.895v-6.665a1.836,1.836,0,0,0-1.2-1.718c5.1-.617,7.467-2.975,7.467-7.424a7.176,7.176,0,0,0-1.637-4.728,6.74,6.74,0,0,0,.275-1.812,4.34,4.34,0,0,0-.52-2.452.574.574,0,0,0-.359-.1c-1.061,0-3.465,1.411-3.936,1.694a16.644,16.644,0,0,0-4.2-.489,16.379,16.379,0,0,0-3.969.445c-.846-.5-2.91-1.649-3.859-1.649a.566.566,0,0,0-.354.095,4.3,4.3,0,0,0-.521,2.452,6.7,6.7,0,0,0,.244,1.718,7.346,7.346,0,0,0-1.6,4.822,7.263,7.263,0,0,0,1.533,4.985c1.193,1.359,3.115,2.165,5.871,2.464a1.826,1.826,0,0,0-1.129,1.693v.5h0l-.006,0a7.121,7.121,0,0,1-2.033.363,2.608,2.608,0,0,1-.965-.158,4.438,4.438,0,0,1-1.836-1.881,2.361,2.361,0,0,0-1.248-1.091,3.472,3.472,0,0,0-1.217-.3.584.584,0,0,0-.545.224.282.282,0,0,0,.027.367,1.875,1.875,0,0,0,.447.307,4.732,4.732,0,0,1,.561.355,10.726,10.726,0,0,1,1.682,2.755c.043.092.078.163.105.217a3.876,3.876,0,0,0,2.42,1.185,6.036,6.036,0,0,0,.607.025c.875,0,1.988-.124,2-.125Z" transform="translate(11461 -1015)" fill="var(--footer-icons)"></path><g id="Ellipse_670" data-name="Ellipse 670" transform="translate(-13522.5 6994)" fill="none" stroke="var(--footer-icons)" stroke-width="1"><circle cx="16" cy="16" r="16" stroke="none"></circle><circle cx="16" cy="16" r="15.5" fill="none"></circle></g></g></g></svg></a></li><li class="social"><a href="https://linkedin.com/in/btholt"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="32" height="32" viewBox="0 0 32 32"><defs><clipPath id="clip-linkedin-social"><rect width="32" height="32"></rect></clipPath></defs><g id="linkedin-social" clip-path="url(#clip-linkedin-social)"><g id="Group_270" data-name="Group 270" transform="translate(-86.349 -633.073)"><path id="Path_375" data-name="Path 375" d="M115.789,633.073a2.324,2.324,0,0,1,1.682.676,2.194,2.194,0,0,1,.695,1.627V662.8a2.131,2.131,0,0,1-.695,1.609,2.314,2.314,0,0,1-1.646.659H88.69a2.307,2.307,0,0,1-1.646-.659,2.128,2.128,0,0,1-.695-1.609V635.376a2.19,2.19,0,0,1,.695-1.627,2.322,2.322,0,0,1,1.682-.676h27.063Zm-20.224,9.672a2.561,2.561,0,0,0,0-3.584,2.658,2.658,0,0,0-1.938-.712,2.724,2.724,0,0,0-1.957.712,2.371,2.371,0,0,0-.75,1.792,2.4,2.4,0,0,0,.731,1.792,2.605,2.605,0,0,0,1.9.713h.037A2.7,2.7,0,0,0,95.565,642.745ZM96,645.434H91.213V659.88H96Zm17.3,6.144a7.007,7.007,0,0,0-1.573-4.9,5.68,5.68,0,0,0-6.839-.769,5.663,5.663,0,0,0-1.426,1.573v-2.048H98.674q.036.841,0,7.717v6.728h4.791V651.8a3.592,3.592,0,0,1,.146-1.17,2.913,2.913,0,0,1,.878-1.206,2.429,2.429,0,0,1,1.609-.549,2.108,2.108,0,0,1,1.865.914,4.265,4.265,0,0,1,.549,2.341v7.752H113.3Z" fill="var(--footer-icons)"></path></g></g></svg></a></li><li class="social"><div class="terms"><p>Content Licensed Under CC-BY-NC-4.0</p><p>Code Samples and Excercises Licensed Under Apache 2.0</p><p>Site Designed by<!-- --> <a href="https://www.alexdanielson.com/">Alex Danielson</a></p></div></li></ul></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"attributes":{"title":"sqlite3"},"html":"\u003cp\u003eThere are so many libraries for connecting to SQLite. It\u0026#39;s a very ubiquitious piece of software and so lots of people have opinions on how to build with it.\u003c/p\u003e\n\u003cp\u003eI am going to show you the standard one, the first one, the one that everyone knows. I will say that when I build stuff with SQLite, it is \u003cem\u003enot\u003c/em\u003e the one I normally choose. However I think it\u0026#39;s good for you to get exposure to the OG and then you can branch out and choose other libraries once you know what you\u0026#39;re getting away from.\u003c/p\u003e\n\u003cp\u003e\u003ca href=\"https://github.com/TryGhost/node-sqlite3/wiki/API\"\u003eClick here\u003c/a\u003e to go to the sqlite3 docs.\u003c/p\u003e\n\u003cblockquote\u003e\n\u003cp\u003eWhy is it sqlite3? It\u0026#39;s because it\u0026#39;s for version 3 of SQLite, the third major version.\u003c/p\u003e\n\u003c/blockquote\u003e\n\u003ch2\u003eConnecting to the database\u003c/h2\u003e\n\u003cp\u003eConnecting to a SQLite database from Node.js is a snap. Import the the sqlite3 library and create a \u003ccode\u003enew\u003c/code\u003e database.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003eimport\u003c/span\u003e sqlite3 \u003cspan class=\"hljs-keyword\"\u003efrom\u003c/span\u003e \u003cspan class=\"hljs-string\"\u003e\u0026quot;sqlite3\u0026quot;\u003c/span\u003e;\n\n\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e db = \u003cspan class=\"hljs-keyword\"\u003enew\u003c/span\u003e sqlite3.\u003cspan class=\"hljs-title class_\"\u003eDatabase\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e\u0026quot;./my-database.db\u0026quot;\u003c/span\u003e);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eAgain, keep in mind that SQLite databases are files. You need to give it a file path to be able to open the database and to start writing to it.\u003c/p\u003e\n\u003ch2\u003eQuerying the database\u003c/h2\u003e\n\u003cp\u003eOnce you have your \u003ccode\u003edb\u003c/code\u003e Database instance, you can then start running queries. There\u0026#39;s a few functions to be aware of. We\u0026#39;ll talk about the parameters to the functions after this.\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003e\u003ccode\u003edb.run(sql, params, callback)\u003c/code\u003e – This will run a query and not care about the results. You generally use this to run \u003ccode\u003eUPDATE\u003c/code\u003e and \u003ccode\u003eDELETE\u003c/code\u003e commands as you\u0026#39;re just updating and not necessarily caring about what the database has to say back to you.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edb.get(sql, params, callback)\u003c/code\u003e – Runs a query and only gives you back the first one. Some times all you need is one result (like when you\u0026#39;re querying a unique ID). This simplifies your code a bit because you don\u0026#39;t need an array of one result.\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edb.all(sql, params, callback)\u003c/code\u003e – Like get, but it gives you all results back that match the query instead of just one. It always returns an array. If you got no results, you get an empty array\u003c/li\u003e\n\u003cli\u003e\u003ccode\u003edb.each(sql, params, callback, complete)\u003c/code\u003e – Like all, but instead of one big array of results, your callback will get called once for each row in the set. Then the complete function will be called to let you know it\u0026#39;s done. This is nice if you have some action you want to take on each row as it\u0026#39;s basically a \u003ccode\u003e.map()\u003c/code\u003e of the result set instead of an array.\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003eNode.js style callbacks (a.k.a. \u0026quot;Nodebacks\u0026quot;)\u003c/h2\u003e\n\u003cp\u003eSome of you whippersnappers may be too young to remember writing JavaScript before promises, async-await, generators, etc. Before the magical time of ES2015 / ES6, we only had one way to deal with asynchronous code, callbacks. These are just functions that are invoked when something async completes. JS has since long moved past this (nearly a decade as of writing) and it\u0026#39;s to the point that it feels weird to write callbacks as we\u0026#39;ve been writing promises so long.\u003c/p\u003e\n\u003cp\u003esqlite3 never updated to use promises so you still have to use Node.js-style callbacks (or Nodebacks, as they were sometimes called.) They are Node.js callbacks as they always have the signature of \u003ccode\u003efunction myCallback(error, data)\u003c/code\u003e. If that \u003ccode\u003eerror\u003c/code\u003e is populated with anything, it means that something went wrong. Otherwise it succeeded. That\u0026#39;s it. That\u0026#39;s what makes a \u0026quot;Nodeback\u0026quot;.\u003c/p\u003e\n\u003cp\u003eSo with \u003ccode\u003e.all()\u003c/code\u003e, your code will look like this\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003edb.\u003cspan class=\"hljs-title function_\"\u003erows\u003c/span\u003e(\n  \u003cspan class=\"hljs-string\"\u003e`SELECT * FROM Track WHERE name LIKE \u0026#x27;%live%\u0026#x27;`\u003c/span\u003e,\n  [], \u003cspan class=\"hljs-comment\"\u003e// we\u0026#x27;ll talk about this array in a sec\u003c/span\u003e\n  \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eerr, rows\u003c/span\u003e) {\n    \u003cspan class=\"hljs-keyword\"\u003eif\u003c/span\u003e (err) {\n      \u003cspan class=\"hljs-comment\"\u003e// do error stuff here\u003c/span\u003e\n      \u003cspan class=\"hljs-keyword\"\u003ereturn\u003c/span\u003e;\n    }\n\n    \u003cspan class=\"hljs-comment\"\u003e// do stuff here with rows\u003c/span\u003e\n  }\n);\n\u003c/code\u003e\u003c/pre\u003e\u003ch2\u003eParameters and SQL Injection\u003c/h2\u003e\n\u003cp\u003eLet\u0026#39;s take this example:\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e id = \u003cspan class=\"hljs-title function_\"\u003egetIdFromUser\u003c/span\u003e();\ndb.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`SELECT * FROM Track WHERE TrackId=\u003cspan class=\"hljs-subst\"\u003e${id}\u003c/span\u003e`\u003c/span\u003e, [], \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eerr, row\u003c/span\u003e) {\n  \u003cspan class=\"hljs-comment\"\u003e// do stuff\u003c/span\u003e\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eWhat\u0026#39;s wrong with this? There\u0026#39;s a \u003cstrong\u003emajor\u003c/strong\u003e problem with this. If that id is coming from a user, it means they can put \u003cem\u003eanything\u003c/em\u003e there, right? So they could in theory put valid SQL in there. What if they put \u003ccode\u003e15; DROP TABLE Customer\u003c/code\u003e? Then your SQL statement would be \u003ccode\u003eSELECT * FROM Track WHERE id=15; DROP TABLE Customer\u003c/code\u003e. Uh oh, good bye to all your customer data. They could also do even more nefarious things like steal your data. This is called SQL injection. This is why you \u003cstrong\u003enever, ever, ever, ever\u003c/strong\u003e put user input directly into a SQL statement. You \u003cem\u003ealways\u003c/em\u003e let the library do it for you. No exceptions.\u003c/p\u003e\n\u003cp\u003eSo how do we fix this? sqlite3 gives us that array to handle just that.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e id = \u003cspan class=\"hljs-title function_\"\u003egetIdFromUser\u003c/span\u003e();\ndb.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\u003cspan class=\"hljs-string\"\u003e`SELECT * FROM Track WHERE TrackId=?`\u003c/span\u003e, [id], \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eerr, row\u003c/span\u003e) {\n  \u003cspan class=\"hljs-comment\"\u003e// do stuff\u003c/span\u003e\n});\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eDone! By replacing it with the question mark and providing the user input in the array, sqlite3 will guarantee you that it\u0026#39;s safe to use that no matter where it came from. You can also use an object notation.\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"hljs language-javascript\"\u003e\u003cspan class=\"hljs-keyword\"\u003econst\u003c/span\u003e id = \u003cspan class=\"hljs-title function_\"\u003egetIdFromUser\u003c/span\u003e();\ndb.\u003cspan class=\"hljs-title function_\"\u003eget\u003c/span\u003e(\n  \u003cspan class=\"hljs-string\"\u003e`SELECT * FROM Track WHERE TrackId=$id`\u003c/span\u003e,\n  { \u003cspan class=\"hljs-attr\"\u003e$id\u003c/span\u003e: id },\n  \u003cspan class=\"hljs-keyword\"\u003efunction\u003c/span\u003e (\u003cspan class=\"hljs-params\"\u003eerr, row\u003c/span\u003e) {\n    \u003cspan class=\"hljs-comment\"\u003e// do stuff\u003c/span\u003e\n  }\n);\n\u003c/code\u003e\u003c/pre\u003e\u003cp\u003eBoth are fine. Question marks rely on order, objection notation relies on names matching.\u003c/p\u003e\n\u003cp\u003eThis should be enough of an intro for you to write your sample app.\u003c/p\u003e\n","markdown":"\nThere are so many libraries for connecting to SQLite. It's a very ubiquitious piece of software and so lots of people have opinions on how to build with it.\n\nI am going to show you the standard one, the first one, the one that everyone knows. I will say that when I build stuff with SQLite, it is _not_ the one I normally choose. However I think it's good for you to get exposure to the OG and then you can branch out and choose other libraries once you know what you're getting away from.\n\n[Click here][sqlite3] to go to the sqlite3 docs.\n\n\u003e Why is it sqlite3? It's because it's for version 3 of SQLite, the third major version.\n\n## Connecting to the database\n\nConnecting to a SQLite database from Node.js is a snap. Import the the sqlite3 library and create a `new` database.\n\n```javascript\nimport sqlite3 from \"sqlite3\";\n\nconst db = new sqlite3.Database(\"./my-database.db\");\n```\n\nAgain, keep in mind that SQLite databases are files. You need to give it a file path to be able to open the database and to start writing to it.\n\n## Querying the database\n\nOnce you have your `db` Database instance, you can then start running queries. There's a few functions to be aware of. We'll talk about the parameters to the functions after this.\n\n- `db.run(sql, params, callback)` – This will run a query and not care about the results. You generally use this to run `UPDATE` and `DELETE` commands as you're just updating and not necessarily caring about what the database has to say back to you.\n- `db.get(sql, params, callback)` – Runs a query and only gives you back the first one. Some times all you need is one result (like when you're querying a unique ID). This simplifies your code a bit because you don't need an array of one result.\n- `db.all(sql, params, callback)` – Like get, but it gives you all results back that match the query instead of just one. It always returns an array. If you got no results, you get an empty array\n- `db.each(sql, params, callback, complete)` – Like all, but instead of one big array of results, your callback will get called once for each row in the set. Then the complete function will be called to let you know it's done. This is nice if you have some action you want to take on each row as it's basically a `.map()` of the result set instead of an array.\n\n## Node.js style callbacks (a.k.a. \"Nodebacks\")\n\nSome of you whippersnappers may be too young to remember writing JavaScript before promises, async-await, generators, etc. Before the magical time of ES2015 / ES6, we only had one way to deal with asynchronous code, callbacks. These are just functions that are invoked when something async completes. JS has since long moved past this (nearly a decade as of writing) and it's to the point that it feels weird to write callbacks as we've been writing promises so long.\n\nsqlite3 never updated to use promises so you still have to use Node.js-style callbacks (or Nodebacks, as they were sometimes called.) They are Node.js callbacks as they always have the signature of `function myCallback(error, data)`. If that `error` is populated with anything, it means that something went wrong. Otherwise it succeeded. That's it. That's what makes a \"Nodeback\".\n\nSo with `.all()`, your code will look like this\n\n```javascript\ndb.rows(\n  `SELECT * FROM Track WHERE name LIKE '%live%'`,\n  [], // we'll talk about this array in a sec\n  function (err, rows) {\n    if (err) {\n      // do error stuff here\n      return;\n    }\n\n    // do stuff here with rows\n  }\n);\n```\n\n## Parameters and SQL Injection\n\nLet's take this example:\n\n```javascript\nconst id = getIdFromUser();\ndb.get(`SELECT * FROM Track WHERE TrackId=${id}`, [], function (err, row) {\n  // do stuff\n});\n```\n\nWhat's wrong with this? There's a **major** problem with this. If that id is coming from a user, it means they can put _anything_ there, right? So they could in theory put valid SQL in there. What if they put `15; DROP TABLE Customer`? Then your SQL statement would be `SELECT * FROM Track WHERE id=15; DROP TABLE Customer`. Uh oh, good bye to all your customer data. They could also do even more nefarious things like steal your data. This is called SQL injection. This is why you **never, ever, ever, ever** put user input directly into a SQL statement. You _always_ let the library do it for you. No exceptions.\n\nSo how do we fix this? sqlite3 gives us that array to handle just that.\n\n```javascript\nconst id = getIdFromUser();\ndb.get(`SELECT * FROM Track WHERE TrackId=?`, [id], function (err, row) {\n  // do stuff\n});\n```\n\nDone! By replacing it with the question mark and providing the user input in the array, sqlite3 will guarantee you that it's safe to use that no matter where it came from. You can also use an object notation.\n\n```javascript\nconst id = getIdFromUser();\ndb.get(\n  `SELECT * FROM Track WHERE TrackId=$id`,\n  { $id: id },\n  function (err, row) {\n    // do stuff\n  }\n);\n```\n\nBoth are fine. Question marks rely on order, objection notation relies on names matching.\n\nThis should be enough of an intro for you to write your sample app.\n\n[sqlite3]: https://github.com/TryGhost/node-sqlite3/wiki/API\n","slug":"sqlite3","title":"sqlite3","section":"Build a Project with Node.js and SQLite","icon":"circle-nodes","filePath":"/home/runner/work/complete-intro-to-sqlite/complete-intro-to-sqlite/lessons/05-build-a-project-with-nodejs-and-sqlite/B-sqlite3.md","nextSlug":"/lessons/build-a-project-with-nodejs-and-sqlite/project","prevSlug":"/lessons/build-a-project-with-nodejs-and-sqlite/the-example-app"}},"__N_SSG":true},"page":"/lessons/[section]/[slug]","query":{"section":"build-a-project-with-nodejs-and-sqlite","slug":"sqlite3"},"buildId":"UVFsG-h6A31FVwYuYsLRa","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>